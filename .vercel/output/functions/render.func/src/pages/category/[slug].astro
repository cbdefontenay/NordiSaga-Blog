---
import { getCollection } from "astro:content";
import CategoryList from '../../components/CategoryList.astro';
import PostList from '../../components/PostList.astro';
import Layout from '../../layouts/Layout.astro';

const page = Number(Astro.url.searchParams.get('page')) || 1;
const postsPerPage = Number(import.meta.env.POSTS_PER_PAGE);
const start = postsPerPage * (page - 1);
const end = start + postsPerPage;

const category = Astro.params.slug as string;
const allPosts = await getCollection('posts');
const postsByCategory = allPosts
  .filter((post) => post.data.categories.includes(category));

  const posts = postsByCategory.slice(start, end);
---

<Layout
  title="Blog - Rhythm Nation">
    <a href="/blog" class="text-zinc-500 text-2xl mb-16 underline block"
      >‚Üê Back to all blogs</a
    >

    <p class="text-zinc-900 text-2xl mb-24 max-sm:mb-14">
      Join the Community and learn from Music Producers and Enthusiasts
    </p>

    <CategoryList categories={[category]} title="Posts tagged" />
    {
        posts.length === 0 ? (
            <p>No posts were found with that tag</p>
            ) : (
          <div class="mb-12">
          </div>
        <PostList posts={posts} />
        <div class="mb-36">
        </div>
      )
    }
</Layout>